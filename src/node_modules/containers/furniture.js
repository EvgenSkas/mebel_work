import React, { Component } from 'react';
import { connect } from 'react-redux';
import { 
	fetchFurniture, 
	loadMoreFurniture,
	addFurnitureToBasket,
	fetchCategories
} from 'actions';
import {getFurniture} from 'selectors';
import R from 'ramda';
import {Link} from 'react-router';

class Furniture extends Component {
	// constructor(props) {
	// 	super(props); 
	// }
	componentDidMount() {
		this.props.fetchFurniture()
		this.props.fetchCategories()
	}

	renderFurniture(furn, index) {
		const {addFurnitureToBasket} = this.props;
		const shortDescreption = R.take(56, furn.description);
		return (
			<div key={index} className='col-sm-4 col-lg-3 col-md-4 book-list'>
				<div className='thumbnail'>
					<img 
						className='img-thumbnail'
						src={furn.image}
						alt={furn.name}
					/>
					<div className='caption'>
						<h4 className='pull-right'>${furn.price}</h4>
						<h4>
							<Link to={`./furniture/${furn.id}`}>
								{furn.name}
							</Link>
						</h4>
						<p>{shortDescreption}</p>
						<p className='itemButton'>
							<button 
								className='btn btn-primary'
								onClick={() => addFurnitureToBasket(furn.id)}
							>
								Buy now!
							</button>
							<Link
								to={`/furniture/${furn.id}`}
								className='btn btn-default'
							> 
								More info 
							</Link>
						</p>
					</div>
				</div>
			</div>
		)
	}
	
	render() {
		const {furniture, loadMoreFurniture} = this.props
		return (
			<div>
				<div className="furniture">
					<h2>PRODUCTS</h2>
					{furniture.map((furn, index) => this.renderFurniture(furn, index))}
					<div className='row'>
						<div className='col-md-12'>
							<button
								className='pull-right btn btn-primary'
								onClick={loadMoreFurniture}
							>
								Load more
							</button>
						</div>
					</div>
					
				</div>
			</div>
		)
	}
}
const mapStateToProps = (state, ownProps) => ({
	furniture: getFurniture(state, ownProps)
});

const mapDispatchToProps = {
	fetchFurniture,
	loadMoreFurniture,
	addFurnitureToBasket,
	fetchCategories
};

export default connect(mapStateToProps, mapDispatchToProps)(Furniture);