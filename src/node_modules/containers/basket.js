import React from 'react';
import { connect } from 'react-redux';
import {
	getBasketFurnitureWithCount,
	getTotalBasketPrice
} from 'selectors';
import R from 'ramda';
import {
	removeFurnitureFromBasket,
	basketCheckout,
	cleanBasket
}	from 'actions';
import { Link } from 'react-router'

const Basket = ({
		furniture, 
		totalPrice, 
		removeFurnitureFromBasket,
		basketCheckout, 
		cleanBasket
	}) => {
	const isBasketEmpty = R.isEmpty(furniture);
	const renderContent = () => (
		<div>
			{isBasketEmpty && <div>Your shopping cart is empty</div>}

			<div className='table-responsive'>
				<table className='table-bordered table-striped table-condensed cf'>
					<tbody>
						{furniture.map((furn, index) => (
							<tr
								key={index}
								className='item-checout'
							>
								<td className='first-column-checkout'>
									<img
										className='img-thumbnail'
										src={furn.image}
										alt={furn.name}
									/>
								</td>
								<td>{furn.name}</td>
								<td>${furn.price}</td>
								<td>{furn.count}</td>
								<td>
									<span 
										onClick={() => removeFurnitureFromBasket(furn.id)}
										className='delete-cart' 
									/>
								</td>
							</tr>
						))}
					</tbody>
				</table>
				<div>
					{
						R.not(isBasketEmpty) &&
						<div className='row'>
							<div className='pull-right total-user-checkout'>
								<b>Total:</b>
								${totalPrice}
							</div>
						</div>
					}
				</div>
			</div>
		</div>
	)

	const renderSidebar = () => {
		return (
			<div>
				<Link
				to='/furniture'
				className='btn btn-info'
			>
				<span className='glyphicon glyphicon-info-sign' />
				<span>Continue shopping</span>
			</Link>
			<br/>
			{
				R.not(isBasketEmpty) &&
				<div>
					<button 
						onClick={cleanBasket}
						className='btn btn-danger'
					>
						<span className='glyphicon glyphicon-trash' />
						Clear cart
					</button>
					<br/>
					<button 
						className='btn btn-success' 
						onClick={() => basketCheckout(furniture)}
					>
						<span className='glyphicon glyphicon-envelope' />
						Checkout
					</button>
				</div>
			}
			</div>
		)
	}
	return (
		<div className='container basket'>
			<div className='row'>
				<div className='col-md-8'>
					{renderContent()}
				</div>
				<div className='col-md-4'>
					{renderSidebar()}
				</div>
			</div>
		</div>
	)
}

const mapStateToProps = state => ({
	furniture: getBasketFurnitureWithCount(state),
	totalPrice: getTotalBasketPrice(state)
})

const mapDispatchToProps = ({
	removeFurnitureFromBasket,
	basketCheckout,
	cleanBasket
})
export default connect(mapStateToProps, mapDispatchToProps)(Basket);

